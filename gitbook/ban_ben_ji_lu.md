# 版本记录


---

## DomeOS v1.0-RC2

发布时间：2018-07-02

### 更新内容

#### 项目
1. 增加了“项目镜像”详情页，用户可以查看该项目下所有的镜像；
2. 增加了“镜像同步”详情页，用户可以同步镜像；
3. 增加了分页功能，提高项目列表加载速度

#### 基础镜像
1. 将基础镜像中的项目镜像列表移到了项目的详情页；
2. 将镜像同步功能移到了项目的详情页；
3. 镜像试用功能同步迁移到了项目中；

#### 服务
1. 增加了“数据卷”的详情页，用户可以新建、查看数据卷；
2. 增加了“操作记录”的详情页，用户可以查看服务、数据卷和部署的操作记录；
3. 增加了分页功能，提高服务列表加载速度；

#### 部署
1. 增加了同时启动和升级多个部署版本的功能（金丝雀发布）；
2. 增加了终止部署实例宽限时间的功能；
3. 增加了设置部署实例HOSTS文件的功能；
4. 增加了自定义部署版本名称的功能；
5. 增加了部署列表的分页功能;
6. 增加了自定义部署实例配置文件功能；
7. 增加了“升级历史”的详情页，用户可以升级/回滚到特定历史操作的版本；
8. 增加了“配置文件”的详情页，用户可以修改正在运行版本的配置文件内容（程序需要支持热加载）；
9. 去除了部署的迁移功能；
10. 去除了工作场景配置项；
11. 去除了集群配置项，更改为资源包；
12. 去除了新建部署时的升级策略配置项；
13. 去除了对YAML和JSON配置类型部署的支持；
14. 去除了对ReplicationController类型的部署的支持；
15. 去除了namespace配置项，用户原有namespace继续保留；
16. 去除了对部署迁移功能的支持；
17. 新建部署时选择集群变更为选择资源包；
18. 新建部署时可以同时设置集群内访问和集群外访问；
19. 新建部署时选择Host的网络模式，如果想设置对外暴露端口个数，需要设置环境变量NEED_PORTS；
20. 优化精简了部署实例的事件记录；
21. 优化提升了部署状态更改的速度；
22. 优化提升了部署详情页的加载速度；
23. 将部署中的启动命令和启动参数合并为启动命令；
24. 将配置文件的功能移到了各个部署版本中；
25. 解决了部署状态有时显示不准确的bug；

#### 负载均衡
1. 将kube-proxy类型的负载均衡移到了对应的部署中；
2. 去除了namespace配置项，用户原有namespace继续保留；
3. 去除了工作场景配置项；
4. 将官方的nginx镜像仓库地址修改为私有仓库地址；
5. 解决了有时关联部署失败的bug；

#### 存储
1. 将数据卷功能移到了服务中；

#### 配置集合
1. 将配置文件信息移到了部署版本的容器配置项中；

#### 集群
1. 新增集群dns组件，新建k8s集群时无需再额外创建kube2sky和skydns；
2. 优化改进集群watcher组件，赋予其更多功能，并精简配置项；
3. 将组件的镜像仓库地址统一修改为私有仓库地址；

## DomeOS v0.6

发布时间：2017-06-02


### 更新内容

#### 总览页面
1. 增加了负载均衡使用情况概览以及负载均衡模块的操作记录。
2. 增加了配置使用情况概览以及配置模块的操作记录。
3. 细化了最近一周操作中的部署信息。
4. 优化了最近一周操作记录的展示速度。
5. 完善了今日操作记录中有关部署的相关操作记录。


#### 开发集成

**项目**

1. 新建工程时增加跨项目复制已有工程功能。
2. 工程构建时增加构建记录的时间展示。
3. 修复java专属构建中提示文字与操作情况不符问题。
4. 修复gitlab信息删除后，关联到该gitlab的工程无法访问的bug。
5. 修复java专属配置镜像列表偶尔加载不出来的问题。
6. 改进java专属构建逻辑，可以获取用户上传的镜像。
7. 改进专属构建类型的工程，编译命令可以直接填写脚本。


#### 运维管理

**服务**

1. 新建部署时健康检查增加失败次数、成功次数、检查周期配置项。
2. 新建部署时增加复制已有部署功能。
3. 新建部署时增加配置管理设置。
4. 新建部署时增加就绪性检查。
5. 新建部署时增加启动命令和启动参数设置。
6. 增加部署实例重启功能。
7. 增加根据部署列表名称、状态、所在集群、资源占用比、升级时间排序功能。
8. 在“升级/回滚”的弹出框上增加当前版本信息。
9. 在“扩容/缩容”的弹出框上增加当前实例数信息。
10. 修复部署事件列表错误信息刷新的bug。
11.	修复新建部署时，集群列表偶尔展示不成功的bug。
12.	修复部署版本信息展示时，前端可能无法显示环境变量的bug。
13.	修复为容器添加日志时，多个日志文件在同一路径下不能正确收集的问题。
14.	修复host模式自动获取端口的问题。
15.	修复调用cluster接口用户无集群权限导致部署页面不能显示的问题。
16.	优化调整部署添加存储的界面操作。
17.	调整日志收集flume镜像默认的资源占用量。
18.	调整部署资源占用比计算方式。
19.	将Overlay网络模式的对外服务，放到了负载均衡模块；对内服务可添加多端口、粘性会话，同时在“网络/访问”处可修改对内服务。


**集群**

1. 增加监听器，通过监听器来收集kubernetes event事件等。
2. 增加通过主机标签筛选主机功能。
3. 增加主机列表、实例列表的排序功能。
4. 增加从集群中的主机实例跳转到部署详情的实例列表功能。
5. 主机信息增加主机内核、版本以及docker、kubernetes版本等信息。
6. 主机列表可以选择性的展示主机信息。


**负载均衡**

1. 新增加模块，可以在该模块创建对外服务类型的负载均衡，目前支持kube_proxy和nginx两种类型。

**配置集合**

1. 新增加模块，可以在该模块新建配置，并在新建部署时将该配置挂载到容器中的指定目录。

#### 监控报警

**监控**

1. 增加负载均衡实例的监控。

#### 全局设置

1. 登录管理：新增SSO登录功能。
2. 代码仓库：删除gitlab时，会根据工程关联情况给出明确提示。


#### 其他更新

1. 点击编辑（修改）按钮时获取最新数据功能，包括编辑工程配置、修改部署“网络/访问”、编辑配置详情。
2. 前端页面采用懒加载方式，解决前端缓存问题，提高前端页面加载渲染速度。
3. 前端页面对话框重构。


#### 注意事项

本次更新，需要修改数据库，不影响已有数据，从v0.5版本更新请执行如下SQL文件：

       https://github.com/domeos/server/blob/release-0.6/src/main/resources/update-db/update-db-v0.5-to-v0.6.sql

## DomeOS v0.5

发布时间：2017-03-01


### 更新内容

#### 总览页面
1. 增加了总览页面详情，展示DomeOS当前运行情况。

#### 开发集成

**项目**

1. 新建工程时增加多gitlab选项，可关联多个gitlab仓库。
2. 构建记录增加翻页功能。
3. 工程增加停止构建的功能。
4. 添加gitlab8以上版本，支持runners-token功能。
5. 增加修改工程所有者的功能。
6. 修复gitlab comit信息记录问题
7. 项目成员增加导入其他用户组功能。
8. 增加构建的停止功能。
9. 修复新建项目时不能勾选自动构建的bug。

**镜像**

1. 增加官方仓库，用户可以查看下载DomeOS官方仓库中的镜像。

#### 运维管理

**服务**

1. 新建部署时增加存储设置。
2. 新建部署时增加多种部署类型进行选择。
3. 新建部署时，添加部署描述，并可修改部署描述。
4. 增加创建部署时添加其他镜像功能。
5. 部署升级时增加修改实例个数功能。
6. 部署停止时增加提示信息。
7. 增加实例状态信息展示。
8. 服务成员增加导入其他用户组功能。
9. 修复删除部署列表非空服务的bug。
10. 调整部署滚动升级策略，RC类型的部署会在对应kubernetes集群生成升级job。
11. 调整部署状态检查策略。

**集群**

1. 集群成员增加导入其他用户组功能。
2. 实现集群中查看所有实例功能，支持列表所有内容检索，表格多列展示和隐藏。
3. 主机列表中添加主机状态。

#### 监控报警

**报警**

1. 更改报警组成员列表展示策略，所有人均有权限查看。
2. 增加通过groovy动态加载报警配置。

#### 全局设置

1. 代码仓库部分：可添加关联多个代码仓库。

#### 其他更新

1. 可配置环境变量，使用redis作为用户登录session的缓存，不配置时使用内存记录用户session。
2. 修改用户session缓存失效策略，用户登录后1小时无访问请求session失效。
3. DomeOS server可以多副本部署。
4. 资源的用户管理部分逻辑调整。
5. 修复markdown文件中文显示乱码问题。
6. 增加了pub.domeos.org镜像仓库页面。

#### 注意事项

本次更新，需要修改数据库，不影响已有数据，从v0.4版本更新请执行如下SQL文件：

       https://github.com/domeos/server/blob/release-0.5/src/main/resources/update-db/update-db-v0.4-to-v0.5.sql


## DomeOS v0.4

发布时间：2016-11-16


### 更新内容

#### 开发集成

调整DomeOS模块划分，将原有项目管理和镜像管理功能划分到开发集成中。开发集成包含了docker镜像生成的完整流程。

**项目**

1. 修改项目的概念，将项目作为一组工程的集合，在项目中可以对用户权限进行管理
2. 更新了权限管理方式，可以给项目配置用户权限，项目可以被设置为公开，则所有用户均有查看权限，工程权限继承自项目
3. 新建工程中添加定制化配置，用户可以直接填写dockerfile启动构建，生成镜像

**镜像**

1. 修改基础镜像管理权限，只有admin可以添加删除
2. 修改项目镜像展示策略，不属于用户可见的项目的镜像被分类到其他镜像中
3. 取消镜像定制功能，该功能被集成到项目中
4. 增加了镜像删除功能

#### 运维管理

调整DomeOS模块划分，将原有部署、集群、应用商店划分到运维管理中。运维管理包含了docker容器运行管理的完成流程。

**服务**

1. 增加服务的概念，作为一组部署的集合，在服务中可以对用户权限进行管理
2. 更新了权限管理方式，可以给服务配置用户权限，部署权限继承自服务
3. 新建部署逻辑调整，先配置集群信息，再配置镜像信息
4. 新建部署增加YAML和JSON两种类型的支持，用户可以自定义容器配置
4. 增加两种部署展示方式的切换功能，既可以直接查看部署列表，又可以查看服务列表
5. 增加部署在不同服务间迁移的功能
6. 增加镜像拉取策略配置
7. 修改日志收集配置逻辑，可以给每个容器单独配置日志收集方案

**集群**

1. 更新了权限管理方式，不再有用户组的概念
2. 支持添加通过https方式访问的kubernetes集群，支持添加加密的kubernetes集群

#### 监控报警

调整DomeOS模块划分，监控、报警拆分展示。监控报警包含了kubernetes主机、docker容器的信息收集与监控。

**监控**

1. 去掉原有报警设置内容

**报警**

1. 作为单独的配置模块

#### 其他更新

1. DomeOS可以作为docker registry的auth server
2. 调整Kubernetes部署脚本，可以部署https访问、有用户名密码的集群
3. 支持https访问的gitlab代码仓库
4. 优化部署状态检测方案
5. 更新kubenetes sdk
6. 增加提示信息

#### 注意事项

本次更新，需要修改数据库，不影响已有数据，从v0.3版本更新请执行如下SQL文件：

       https://github.com/domeos/server/blob/release-0.4/DomeOS/src/main/resources/update-db/update-db-v0.3-to-v0.4.sql


##DomeOS v0.3

发布时间：2016-06-07

###更新内容

**项目管理**

1. 项目列表页增加构建类型、 自动构建展示
2. 新建项目时增加Dockerfile预览
3. 新增通过tag查看Dockerfile功能
4. 新增Java专属构建功能
5. 官方仓库增加Java编译和运行镜像
6. 构建选择分支或版本时增加搜索功能

**部署管理**

1. 部署动作增加中断功能
2. 修复部署删除时事件信息仍然存在问题
3. 可以为每个容器添加健康检查
4. 健康检查添加首次检测延迟时间配置项
5. 对外服务提供ip列表
6. 更新部署事件合并逻辑

**集群管理**

1. 更改构建集群的展示方式和构建主机的配置方式
2. 更新添加主机命令生成规则以适应报警功能
3. 添加主机新增支持Ubuntu系统
3. 增加批量添加主机标签的功能

**监控报警**

1. 增加报警功能，包含主机报警与容器报警，可配置主机组与报警模板、报警组成员与权限、查看并处理未恢复报警，后台需要配置相应组件
2. 监控详情修正显示单位错误

**全局配置**

1. 用户管理部分：可配置所有用户的邮箱和电话信息、可删除LDAP用户
2. 监控报警部分：增加报警相关模块以及短信、邮件发送接口配置
3. 构建集群部分：由集群列表中选择构建集群，并直接配置构建主机

**其他修改**

1. DomeOS Server镜像：pub.domeos.org/domeos/server:1.3.0

    更新新版DomeOS代码，修正Shellinabox产生僵尸进程问题，减小镜像体积
 
2. Registry镜像：pub.domeos.org/domeos/docker-registry-driver-sohustorage:1.1

    可以选择使用Mysql或本地文件存储镜像信息，用于加快查询速度
    
    更新上传接口，提高上传速度
 
3. Agent镜像：pub.domeos.org/domeos/agent:2.5

    更新cAdvisor，适用于docker 1.11.1
    
    更新容器网络流量获取逻辑
    
4. Shellinabox镜像：pub.domeos.org/domeos/shellinabox:1.1

    修复产生僵尸进程问题
5. 手动安装Kubernetes for DomeOS的start_master_centos.sh和start_node_centos.sh修改，可通过```bash <脚本名> help```查看具体信息；增加Ubuntu中部署Kubernetes的脚本start_master_ubuntu.sh和start_node_ubuntu.sh。

**注意事项**

本次更新，需要修改数据库，不影响已有数据，从v0.2版本更新请执行如下SQL文件：

       https://github.com/domeos/server/blob/v0.3/DomeOS/src/main/resources/update-db/update-db-v0.2-to-v0.3.sql

##DomeOS v0.2

发布时间：2016-04-21

**重点改动：**

后台数据库表结构调整，需要重新创建表。

其余改动：

项目管理：

1. 修复构建时间不准确问题
2. 修改构建日志展示方式
3. 增加项目删除功能
4. 增加根据tag构建
5. 增加使用代码内dockerfile时，可以指定dockerfile名称

镜像：

1. 增加镜像定制功能
2. 调整镜像大小获取逻辑，以适应新版本registry
3. 修复镜像时区问题，保证DomeOS提供的镜像的时区统一为Asia/Shanghai

部署：

1. 增加部署内网域名
2. 增加部署host模式服务
3. 增加部署对内服务模式
4. 增加镜像版本列表中展示镜像创建时间
5. 增加细致的部署中间状态
6. 增加事件记录中kubernetes操作信息展示
7. 增加事件记录中用户操作的三种状态展示
8. 增加部署状态的自动刷新
9. 修复前端升级功能的bug

监控：

1. 新的监控展示界面
2. 去掉了dashboard组件

集群管理：

1. 增加集群重命名功能
2. 增加集群删除功能
3. 升级了添加node脚本

应用商店：

1. 删除了zookeeper应用
2. 增加了registry应用

其他：

1. 修改前端逻辑，tab页面刷新保持当前tab
2. 调整DomeOS Server镜像jvm内存，修复了内存分配过大问题。

##DomeOS v0.1

发布时间：2016-01-21

